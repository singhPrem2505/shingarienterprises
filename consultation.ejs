<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consultation</title>
    <link rel="website icon" type="png" href="./logo.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
      integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.5;
      }
      body {
        background-color: #f0fdf4;
      }
      .back a {
        text-decoration: none;
        color: black;
        font-size: 5vh;
      }
      .back {
        margin: 3vw 0 0 3vw;
      }
      .back i {
        background-color: #f0fdf4;
      }
      .consultation {
        max-width: 90vw;
        margin: 0 auto 4vh auto;
        padding: 0vh 5vw 3vh 5vw;

        border-radius: 1.2vh;
        text-align: center;
        box-sizing: border-box;

        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      #ready {
        padding: 0;
        margin: 0;
        font-weight: 450;
        color: black;
      }
      #line {
        padding: 0;
        margin: 0;
        margin-top: 3vh;

        color: rgb(81, 79, 79);
        width: 45vw;
        text-align: center;
      }
      .container {
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: start;
        justify-content: center;
        padding-left: 3vw;
        padding-top: 5vh;
        width: 50vw;
        height: auto;
        border-radius: 10px;
        background-color: #ffffff;
        margin-bottom: 14vh;
        padding-bottom: 5vh;
        box-shadow: -0.3vh 0.3vh 2vh rgba(0, 0, 0, 0.06),
          0.3vh 0.3vh 1vh rgba(0, 0, 0, 0.06),
          0px 1.1vh 2.5vh rgba(0, 0, 0, 0.15);
      }
      .container p {
        background-color: #ffffff;
        color: black;
        font-weight: 500;
        font-size: 1.15vw;
      }
      .freesolar {
        width: 48vw;
        margin-bottom: 4vh;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
      }
      i {
        margin-right: 10px;
        background-color: #ffffff;
      }
      input {
        border: none;
        border-radius: 9px;
        background-color: rgb(240, 240, 240);
        width: 45vw;
        height: 6.5vh;
        padding: 0 1vw;
      }
      select {
        border: none;
        border-radius: 9px;
        background-color: rgb(240, 240, 240);
        width: 47vw;
        height: 6.5vh;
        padding: 0 1vw;
      }
      .input {
        margin-bottom: 5vh;
      }
      button {
        width: 30vw;
        height: 7vh;
        background-color: #2b7b24;
        color: #ffffff;
        border: none;
        border-radius: 9px;
        font-weight: 500;
      }
      .button {
        margin-left: 9vw;
      }
      .required-star {
        color: red;
        font-weight: bold;
        margin-left: 2px;
      }
      button:active {
        background-color: #153b12;
        color: #d2d1d1;
      }
      button i {
        background-color: #2b7b24;
      }
      button:active i {
        background-color: #153b12;
        color: #d2d1d1;
      }
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      #conformation {
        font-size: 1vw;
        color: grey;
        font-weight: 440;
        width: 50vw;
        text-align: center;
        margin-top: 2vh;
      }
      @media only screen and (max-width: 455px) {
        .back a {
          font-size: 6vw;
        }
        #ready {
          padding: 0;
          margin: 0;
          font-weight: 450;
          color: black;
        }
        #line {
          padding: 0;
          margin: 0;
          margin-top: 3.4vw;

          color: rgb(81, 79, 79);
          width: 83vw;
          text-align: center;
        }
        .container {
          width: 83vw;
          padding-top: 2vh;
        }
        .container p {
          font-size: 1.7vh;
        }
        .freesolar {
          margin-bottom: 2.3vh;
          width: 60vw;
          justify-content: start;
        }
        input {
          width: 75.5vw;
          padding: 0 2.5vw;
        }
        .input {
          margin-bottom: 1.7vh;
        }
        select {
          width: 80vw;
        }
        button {
          width: 40vw;
          height: 6vh;
          font-size: 1.8vh;
        }
        .button {
          margin-left: 19vw;
        }

        #conformation {
          font-size: 1vh;
          color: grey;
          width: 80vw;
        }
      }
    </style>
  </head>
  <body>
    <div class="back">
      <a href="/"><i class="fa-solid fa-arrow-left"></i></a>
    </div>
    <div class="consultation" id="conso">
      <p id="ready">Ready to Go Solar?</p>
      <p id="line">
        Take the first step towards energy independence. Get a free consultation
        and personalized quote for your home solar system.
      </p>
    </div>
    
    <div class="container" type="form">
      <div class="freesolar">
        <i class="fa-solid fa-calculator" style="color: #2b7b24"></i>
        <p>Get Your Free Solar Quote</p>
      </div>
      <div class="input">
        <p>First Name<span class="required-star">*</span></p>
        <input
          type="text"
          name="fname"
          id="fname"
          placeholder="John"
          required
        />
      </div>
      <div class="input">
        <p>Last Name<span class="required-star">*</span></p>
        <input type="text" name="bname" id="bname" placeholder="Deo" required />
      </div>
      <div class="input">
        <p>Email<span class="required-star">*</span></p>
        <input
          type="email"
          name="email"
          id="email"
          placeholder="john@email.com"
          required
        />
      </div>
      <div class="input">
        <p>Phone Number</p>
        <input
          type="tel"
          name="phonenumber"
          id="number"
          placeholder="(+91) 12345-67809"
        />
      </div>
      <div class="input">
        <p>Type of Location<span class="required-star">*</span></p>
        <select name="typeoflocation" id="locationtype" required>
          <option value="" disabled selected hidden>
            Select location type
          </option>
          <option value="Residential">Residential</option>
          <option value="Commercial">Commercial</option>
          <option value="Residential trusts">Residential trusts</option>
        </select>
      </div>
      <div class="input">
        <p>Home Address<span class="required-star">*</span></p>
        <input
          type="text"
          name="address"
          id="address"
          placeholder="123, Main St, City, State, ZIP"
          required
        />
      </div>
      <div class="input">
        <p>
          Average Monthly Electricity Bill(in rupees)<span class="required-star"
            >*</span
          >
        </p>
        <input
          type="number"
          name="avgelectricitybill"
          id="bill"
          placeholder="2468"
          min="0"
          required
        />
      </div>
      <div class="input" id="additional">
        <p>Additional Information</p>
        <input
          type="text"
          name="additionalinfo"
          id="additionalinfo"
          placeholder="Tell us about your roof,any shadow on roof, any concerns, or special requirements..."
        />
      </div>
      <div class="button">
        <button id="send-button">
          <i class="fa-solid fa-paper-plane"></i>Get Free Quote
        </button>
      </div>
      <p id="conformation">
        By submitting this form, you agree to receive communications from
        Shingari Enterprises
      </p>
    </div>
    <script>
      document
        .querySelector("#send-button")
        .addEventListener("click", async (e) => {
          e.preventDefault(); // Prevent default page reload

          const fname = document.querySelector("#fname").value.trim();
          const bname = document.querySelector("#bname").value.trim();
          const email = document.getElementById("email").value.trim();
          const phone = document.getElementById("number").value.trim();
          const location = document.getElementById("locationtype").value;
          const address = document.getElementById("address").value.trim();
          const bill = document.getElementById("bill").value.trim();

          // First name & last name â€” only letters and spaces, at least 2 chars
          const namePattern = /^[A-Za-z]{2,}$/;
          if (!namePattern.test(fname)) {
            alert(
              "Please enter a valid first name (letters only, min 2 characters)."
            );
            return;
          }
          if (!namePattern.test(bname)) {
            alert(
              "Please enter a valid last name (letters only, min 2 characters)."
            );
            return;
          }

          // Email check
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(email)) {
            alert("Please enter a valid email address.");
            return;
          }

          // Phone number â€” must be 10 digits if entered
          if (phone && !/^\d{10}$/.test(phone)) {
            alert("Please enter a valid 10-digit phone number.");
            return;
          }

          // Location type check
          if (!location) {
            alert("Please select a location type.");
            return;
          }

          // Address check â€” at least 5 characters
          if (address.length < 5) {
            alert("Please enter a valid address (min 5 characters).");
            return;
          }

          // Bill check â€” must be a number > 0
          if (!/^\d+$/.test(bill) || Number(bill) <= 0) {
            alert("Please enter a valid electricity bill amount.");
            return;
          }

          // Prepare data
          const fullname = fname + " " + bname;
          const data = {
            _name: fullname,
            email,
            phonenumber: phone,
            typeoflocation: location,
            address,
            avgelectricitybill: bill,
            additionalinfo: document.getElementById("additionalinfo").value,
          };

          // Send data
          try {
            const res = await fetch("/consultation", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });

            if (res.ok) {
              alert("Your details have been saved successfully!");
              window.location.href = "/";
            } else {
              const text = await res.text();
              alert(text || "Failed to save your details.");
            }
          } catch (err) {
            alert("An error occurred while sending your details.");
            console.error(err);
          }
        });
    </script>
  </body>
</html>
